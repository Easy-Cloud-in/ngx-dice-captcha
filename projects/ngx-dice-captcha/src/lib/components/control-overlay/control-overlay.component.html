<mat-card class="control-overlay" [class]="getPositionClass() + ' ' + getLayoutClass()"
    [class.layout-vertical]="layoutMode() === 'vertical'" [class.layout-horizontal]="layoutMode() === 'horizontal'"
    role="region" aria-label="Dice CAPTCHA controls">

    <!-- Cooldown Message -->
    @if (isInCooldown()) {
    <div class="cooldown-message" role="alert" aria-live="polite">
        <mat-icon class="cooldown-icon" aria-hidden="true">schedule</mat-icon>
        <div class="cooldown-text">
            <p class="cooldown-title">Too Many Failed Attempts</p>
            <p class="cooldown-timer">Try again in {{ formatCooldownTime() }}</p>
        </div>
    </div>
    }

    <!-- Main Controls (always visible when not in cooldown) -->
    @if (!isInCooldown()) {
    <form class="controls-wrapper" ngxFormFocusFlow [autoFocus]="shouldAutoFocus()" submitButtonSelector=".btn-verify"
        (submit)="$event.preventDefault(); onVerify()">
        <!-- Roll/Re-Roll Button -->
        <button mat-raised-button color="primary" class="btn-roll" type="button" [disabled]="!canRoll()"
            (click)="onRoll()" [attr.aria-busy]="isRolling()"
            [attr.aria-label]="diceRolled() ? 'Re-roll dice' : 'Roll dice to start verification'">
            <!-- <mat-icon aria-hidden="true">casino</mat-icon> -->
            <span class="btn-text">
                @if (diceRolled()) {
                Re-Roll
                } @else {
                Roll
                }
            </span>
        </button>

        <!-- Dice Inputs (shown after roll) -->
        @if (diceRolled()) {
        <div class="inputs-group">
            <div class="dice-inputs" role="group" aria-label="Enter dice values">
                @for (index of diceIndices(); track index) {
                <div class="input-wrapper">
                    <span class="input-label">D{{ index + 1 }}</span>
                    <input type="text" class="dice-input" maxlength="1" [value]="diceInputs()[index] ?? ''"
                        (input)="updateDiceInput(index, $any($event.target).value)"
                        [attr.aria-label]="'Enter value for die ' + (index + 1)" placeholder="-" inputmode="numeric"
                        pattern="[1-6]" />
                </div>
                }
            </div>

            <div class="input-wrapper sum-wrapper">
                <span class="input-label">Sum</span>
                <!-- <mat-icon class="sum-icon" aria-hidden="true">functions</mat-icon> -->
                <input type="text" class="sum-input" [value]="sumInput() ?? ''"
                    (input)="updateSumInput($any($event.target).value)" aria-label="Enter the total sum of all dice"
                    placeholder="0" inputmode="numeric" pattern="[0-9]*" />
            </div>
        </div>

        <!-- Verify Button -->
        <button mat-raised-button color="accent" class="btn-verify" type="submit" [disabled]="!canVerify()"
            aria-label="Verify your dice values and sum">
            <!-- <mat-icon aria-hidden="true">check_circle</mat-icon> -->
            <span class="btn-text">Verify</span>
        </button>
        }
    </form>
    }
</mat-card>