<div class="control-overlay" [class]="getPositionClass() + ' ' + getLayoutClass()" role="region"
    aria-label="Dice CAPTCHA controls">

    <!-- Cooldown Message -->
    @if (isInCooldown()) {
    <div class="cooldown-message" role="alert" aria-live="polite">
        <span class="cooldown-icon" aria-hidden="true">‚è±Ô∏è</span>
        <div class="cooldown-text">
            <p class="cooldown-title">Too Many Failed Attempts</p>
            <p class="cooldown-timer">Try again in {{ formatCooldownTime() }}</p>
        </div>
    </div>
    }

    <!-- Main Controls (always visible when not in cooldown) -->
    @if (!isInCooldown()) {
    <div class="controls-wrapper">
        <!-- Roll/Re-Roll Button -->
        <button class="btn-roll" type="button" [disabled]="!canRoll()" (click)="onRoll()" [attr.aria-busy]="isRolling()"
            [attr.aria-label]="diceRolled() ? 'Re-roll dice' : 'Roll dice to start verification'">
            <span class="btn-icon" aria-hidden="true">üé≤</span>
            <span class="btn-text">
                @if (diceRolled()) {
                Re-Roll
                } @else {
                Roll
                }
            </span>
        </button>

        <!-- Dice Inputs (shown after roll) -->
        @if (diceRolled()) {
        <div class="inputs-group">
            <div class="dice-inputs" role="group" aria-label="Enter dice values">
                @for (index of diceIndices(); track index) {
                <div class="dice-input-wrapper">
                    <label [for]="'dice-input-' + index" class="dice-label">D{{ index + 1 }}</label>
                    <input [id]="'dice-input-' + index" type="number" class="dice-input" min="1" max="6" step="1"
                        [value]="diceInputs()[index] ?? ''" (input)="updateDiceInput(index, $any($event.target).value)"
                        [attr.aria-label]="'Enter value for die ' + (index + 1)" placeholder="-" inputmode="numeric"
                        pattern="[1-6]" />
                </div>
                }
            </div>

            <div class="sum-input-wrapper">
                <label for="sum-input" class="sum-label">Œ£</label>
                <input id="sum-input" type="number" class="sum-input" min="1" max="120" step="1"
                    [value]="sumInput() ?? ''" (input)="updateSumInput($any($event.target).value)"
                    aria-label="Enter the total sum of all dice" placeholder="Sum" inputmode="numeric" />
            </div>
        </div>

        <!-- Verify Button -->
        <button class="btn-verify" type="button" [disabled]="!canVerify()" (click)="onVerify()"
            aria-label="Verify your dice values and sum">
            <span class="btn-icon" aria-hidden="true">‚úì</span>
            <span class="btn-text">Verify</span>
        </button>
        }
    </div>
    }
</div>